{"ast":null,"code":"import _slicedToArray from\"/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import IVSContext from'./providers/IVSContext';import QuestionsContext from'./providers/QuestionContext';import{SERVER_SET_QUESTIONS_ACTION,SERVER_UPDATE_QUESTIONS_ACTION}from'./providers/QuestionProvider';import{WEBSOCKET_API_ENDPOINT}from'./config';import{jsx as _jsx}from\"react/jsx-runtime\";var WebSocketClient=/*#__PURE__*/function(_React$Component){_inherits(WebSocketClient,_React$Component);var _super=_createSuper(WebSocketClient);function WebSocketClient(){var _this;_classCallCheck(this,WebSocketClient);_this=_super.call(this);_this.channelArn='';return _this;}_createClass(WebSocketClient,[{key:\"setupWebSocket\",value:function setupWebSocket(channelArn){var _this2=this;if(this.channelArn===channelArn){return;}this.channelArn=channelArn;var webSocketUrl=WEBSOCKET_API_ENDPOINT+\"?channelarn=\"+channelArn;this.ws=new WebSocket(webSocketUrl);this.ws.onmessage=function(msg){var _this2$context=_slicedToArray(_this2.context,2),dispatch=_this2$context[1];var message=JSON.parse(msg.data);switch(message.type){case'INITIAL_STATE':console.debug('INIT STATE',message.questions);dispatch({type:SERVER_SET_QUESTIONS_ACTION,questions:message.questions});break;case'UPDATES':console.debug('UPDATE',message.updates);dispatch({type:SERVER_UPDATE_QUESTIONS_ACTION,updates:message.updates});break;default:return;}};}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/_jsx(IVSContext.Consumer,{children:function children(_ref){var channelArn=_ref.channelArn;return _this3.setupWebSocket(channelArn);}});}}]);return WebSocketClient;}(React.Component);WebSocketClient.contextType=QuestionsContext;export default WebSocketClient;","map":{"version":3,"sources":["/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/src/WebSocketClient.js"],"names":["React","IVSContext","QuestionsContext","SERVER_SET_QUESTIONS_ACTION","SERVER_UPDATE_QUESTIONS_ACTION","WEBSOCKET_API_ENDPOINT","WebSocketClient","channelArn","webSocketUrl","ws","WebSocket","onmessage","msg","context","dispatch","message","JSON","parse","data","type","console","debug","questions","updates","setupWebSocket","Component","contextType"],"mappings":"u5BAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,UAAP,KAAuB,wBAAvB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,6BAA7B,CACA,OACIC,2BADJ,CAEIC,8BAFJ,KAGO,8BAHP,CAIA,OAASC,sBAAT,KAAuC,UAAvC,C,8CAEMC,CAAAA,e,8HAGF,0BAAc,iDACV,wBACA,MAAKC,UAAL,CAAkB,EAAlB,CAFU,aAGb,C,0DAED,wBAAeA,UAAf,CAA0B,iBACtB,GAAI,KAAKA,UAAL,GAAoBA,UAAxB,CAAoC,CAChC,OACH,CACD,KAAKA,UAAL,CAAkBA,UAAlB,CACA,GAAMC,CAAAA,YAAY,CAAGH,sBAAsB,eAAtB,CAA0CE,UAA/D,CAEA,KAAKE,EAAL,CAAU,GAAIC,CAAAA,SAAJ,CAAcF,YAAd,CAAV,CAEA,KAAKC,EAAL,CAAQE,SAAR,CAAoB,SAAAC,GAAG,CAAI,CACvB,kCAAqB,MAAI,CAACC,OAA1B,IAASC,QAAT,mBACA,GAAMC,CAAAA,OAAO,CAAGC,IAAI,CAACC,KAAL,CAAWL,GAAG,CAACM,IAAf,CAAhB,CACA,OAAOH,OAAO,CAACI,IAAf,EACI,IAAK,eAAL,CACIC,OAAO,CAACC,KAAR,CAAc,YAAd,CAA4BN,OAAO,CAACO,SAApC,EACAR,QAAQ,CAAC,CACLK,IAAI,CAAEhB,2BADD,CAELmB,SAAS,CAAEP,OAAO,CAACO,SAFd,CAAD,CAAR,CAIA,MACJ,IAAK,SAAL,CACIF,OAAO,CAACC,KAAR,CAAc,QAAd,CAAwBN,OAAO,CAACQ,OAAhC,EACAT,QAAQ,CAAC,CACLK,IAAI,CAAEf,8BADD,CAELmB,OAAO,CAAER,OAAO,CAACQ,OAFZ,CAAD,CAAR,CAIA,MACJ,QACI,OAhBR,CAkBH,CArBD,CAsBH,C,sBAED,iBAAQ,iBACJ,mBACI,KAAC,UAAD,CAAY,QAAZ,WACK,2BAAGhB,CAAAA,UAAH,MAAGA,UAAH,OAAoB,CAAA,MAAI,CAACiB,cAAL,CAAoBjB,UAApB,CAApB,EADL,EADJ,CAKH,C,6BA/CyBP,KAAK,CAACyB,S,EAA9BnB,e,CACKoB,W,CAAcxB,gB,CAiDzB,cAAeI,CAAAA,eAAf","sourcesContent":["import React from 'react';\nimport IVSContext from './providers/IVSContext';\nimport QuestionsContext from './providers/QuestionContext';\nimport { \n    SERVER_SET_QUESTIONS_ACTION,\n    SERVER_UPDATE_QUESTIONS_ACTION,\n} from './providers/QuestionProvider'\nimport { WEBSOCKET_API_ENDPOINT } from './config';\n\nclass WebSocketClient extends React.Component {\n    static contextType = QuestionsContext; \n    \n    constructor() {\n        super();\n        this.channelArn = '';\n    }\n\n    setupWebSocket(channelArn){\n        if (this.channelArn === channelArn) {\n            return;\n        }\n        this.channelArn = channelArn;\n        const webSocketUrl = WEBSOCKET_API_ENDPOINT + `?channelarn=` + channelArn;\n\n        this.ws = new WebSocket(webSocketUrl);\n\n        this.ws.onmessage = msg => {\n            const [, dispatch] = this.context;\n            const message = JSON.parse(msg.data)\n            switch(message.type) {\n                case 'INITIAL_STATE':\n                    console.debug('INIT STATE', message.questions)\n                    dispatch({\n                        type: SERVER_SET_QUESTIONS_ACTION,\n                        questions: message.questions,\n                    })\n                    break;\n                case 'UPDATES':\n                    console.debug('UPDATE', message.updates)\n                    dispatch({\n                        type: SERVER_UPDATE_QUESTIONS_ACTION,\n                        updates: message.updates,\n                    })\n                    break;\n                default:\n                    return;\n            }\n        }\n    }\n\n    render(){\n        return(\n            <IVSContext.Consumer>\n                {({ channelArn }) => this.setupWebSocket(channelArn)}\n            </IVSContext.Consumer> \n        )\n    }\n}\n\nexport default WebSocketClient"]},"metadata":{},"sourceType":"module"}