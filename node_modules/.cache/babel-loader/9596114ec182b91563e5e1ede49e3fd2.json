{"ast":null,"code":"import _regeneratorRuntime from\"/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import QuestionContext from'../../providers/QuestionContext';import IVSContext from'../../providers/IVSContext';import VoteContext from'../../providers/VoteContext';import UserContext from'../../providers/UserContext';import{ADD_VOTE_ACTION,DELETE_VOTE_ACTION}from'../../providers/VoteProvider';import{CLIENT_DECREMENT_VOTE_ACTION,CLIENT_INCREMENT_VOTE_ACTION}from'../../providers/QuestionProvider';import{HTTP_API_ENDPOINT}from'../../config';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ADD_VOTE_ENUM='ADD_VOTE';var DELETE_VOTE_ENUM='DELETE_VOTE';var NONE_ENUM='NONE';var DELETE_VOTE_ENDPOINT=HTTP_API_ENDPOINT+'/deleteVote';var ADD_VOTE_ENDPOINT=HTTP_API_ENDPOINT+'/addVote';function VoteButton(_ref){var votes=_ref.votes,questionId=_ref.questionId,disabled=_ref.disabled;var _React$useContext=React.useContext(QuestionContext),_React$useContext2=_slicedToArray(_React$useContext,2),questionDispatch=_React$useContext2[1];var _React$useContext3=React.useContext(VoteContext),_React$useContext4=_slicedToArray(_React$useContext3,2),questionIdMap=_React$useContext4[0].questionIdMap,voteDispatch=_React$useContext4[1];var _React$useContext5=React.useContext(IVSContext),channelArn=_React$useContext5.channelArn;var _React$useContext6=React.useContext(UserContext),_React$useContext7=_slicedToArray(_React$useContext6,1),accessJWTToken=_React$useContext7[0].accessJWTToken;var _React$useState=React.useState(NONE_ENUM),_React$useState2=_slicedToArray(_React$useState,2),postVoteType=_React$useState2[0],setPostVoteType=_React$useState2[1];React.useEffect(function(){if(postVoteType!==NONE_ENUM){var postVote=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;questionDispatch({type:postVoteType===DELETE_VOTE_ENUM?CLIENT_DECREMENT_VOTE_ACTION:CLIENT_INCREMENT_VOTE_ACTION,id:questionId});voteDispatch({type:postVoteType===DELETE_VOTE_ENUM?DELETE_VOTE_ACTION:ADD_VOTE_ACTION,questionId:questionId});url=postVoteType===DELETE_VOTE_ENUM?DELETE_VOTE_ENDPOINT:ADD_VOTE_ENDPOINT;_context.next=6;return fetch(url,{method:'POST',headers:{'Content-Type':'application/json','Authorization':accessJWTToken},body:JSON.stringify({channelArn:channelArn,questionId:questionId})});case 6:response=_context.sent;if(!(response.status!==200)){_context.next=9;break;}throw new Error();case 9:_context.next=16;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.log('Failed to add/delete vote',_context.t0);questionDispatch({type:postVoteType===DELETE_VOTE_ENUM?CLIENT_INCREMENT_VOTE_ACTION:CLIENT_DECREMENT_VOTE_ACTION,id:questionId});voteDispatch({type:postVoteType===DELETE_VOTE_ENUM?ADD_VOTE_ACTION:DELETE_VOTE_ACTION,questionId:questionId});case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function postVote(){return _ref2.apply(this,arguments);};}();postVote();}// eslint-disable-next-line\n},[postVoteType]);var votedState=!!questionIdMap[questionId];var className='';if(votedState){className='btn rounded upvote-btn has-voted';}else if(disabled){className='btn rounded upvote-btn';}else{className='btn btn--primary rounded upvote-btn';}return/*#__PURE__*/_jsxs(\"button\",{className:className,onClick:function onClick(){return setPostVoteType(votedState?DELETE_VOTE_ENUM:ADD_VOTE_ENUM);},disabled:disabled,children:[/*#__PURE__*/_jsx(\"svg\",{className:\"upvote-btn__svg\",width:\"22\",height:\"22\",viewBox:\"0 0 22 22\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M3.66797 11L4.96047 12.2925L10.0846 7.1775V18.3333H11.918V7.1775L17.033 12.3017L18.3346 11L11.0013 3.66666L3.66797 11Z\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"upvote-btn__count\",children:votes})]});}export default VoteButton;","map":{"version":3,"sources":["/Users/duyennguyen/STREAMING/amazon-ivs-virtual-qa-web-demo/frontend/src/questionList/Question/VoteButton.js"],"names":["React","QuestionContext","IVSContext","VoteContext","UserContext","ADD_VOTE_ACTION","DELETE_VOTE_ACTION","CLIENT_DECREMENT_VOTE_ACTION","CLIENT_INCREMENT_VOTE_ACTION","HTTP_API_ENDPOINT","ADD_VOTE_ENUM","DELETE_VOTE_ENUM","NONE_ENUM","DELETE_VOTE_ENDPOINT","ADD_VOTE_ENDPOINT","VoteButton","votes","questionId","disabled","useContext","questionDispatch","questionIdMap","voteDispatch","channelArn","accessJWTToken","useState","postVoteType","setPostVoteType","useEffect","postVote","type","id","url","fetch","method","headers","body","JSON","stringify","response","status","Error","console","log","votedState","className"],"mappings":"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","sourcesContent":["import React from 'react';\nimport QuestionContext from '../../providers/QuestionContext';\nimport IVSContext from '../../providers/IVSContext';\nimport VoteContext from '../../providers/VoteContext';\nimport UserContext from '../../providers/UserContext';\nimport {\n    ADD_VOTE_ACTION,\n    DELETE_VOTE_ACTION,\n}  from '../../providers/VoteProvider';\nimport {\n    CLIENT_DECREMENT_VOTE_ACTION,\n    CLIENT_INCREMENT_VOTE_ACTION,\n}  from '../../providers/QuestionProvider';\nimport { HTTP_API_ENDPOINT } from '../../config';\n\nconst ADD_VOTE_ENUM = 'ADD_VOTE';\nconst DELETE_VOTE_ENUM = 'DELETE_VOTE';\nconst NONE_ENUM = 'NONE';\n\nconst DELETE_VOTE_ENDPOINT = HTTP_API_ENDPOINT + '/deleteVote';\nconst ADD_VOTE_ENDPOINT = HTTP_API_ENDPOINT + '/addVote';\n\nfunction VoteButton({\n    votes,\n    questionId,\n    disabled,\n}) {\n    const [,questionDispatch] = React.useContext(QuestionContext);\n    const [{ questionIdMap }, voteDispatch] = React.useContext(VoteContext);\n    const { channelArn } = React.useContext(IVSContext);\n    const [{ accessJWTToken }] = React.useContext(UserContext);\n    const [postVoteType, setPostVoteType] = React.useState(NONE_ENUM);\n\n    React.useEffect(() => {\n        if (postVoteType !== NONE_ENUM) {\n            const postVote = async () => {\n                try {\n                    questionDispatch({\n                        type: postVoteType === DELETE_VOTE_ENUM  ? CLIENT_DECREMENT_VOTE_ACTION : CLIENT_INCREMENT_VOTE_ACTION,\n                        id: questionId,\n                    });\n                    voteDispatch({\n                        type: postVoteType === DELETE_VOTE_ENUM  ? DELETE_VOTE_ACTION : ADD_VOTE_ACTION,\n                        questionId,\n                    })\n\n                    const url = postVoteType === DELETE_VOTE_ENUM ? DELETE_VOTE_ENDPOINT : ADD_VOTE_ENDPOINT;\n                    const response = await fetch(url,{\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/json',\n                            'Authorization': accessJWTToken,\n                        },\n                        body: JSON.stringify({\n                            channelArn,\n                            questionId,\n                        }),\n                    });\n\n                    if (response.status !== 200) {\n                        throw new Error();\n                    }\n                } catch (e){\n                    console.log('Failed to add/delete vote', e);\n                    questionDispatch({\n                        type: postVoteType === DELETE_VOTE_ENUM  ? CLIENT_INCREMENT_VOTE_ACTION : CLIENT_DECREMENT_VOTE_ACTION,\n                        id: questionId,\n                    });\n                    voteDispatch({\n                        type: postVoteType === DELETE_VOTE_ENUM  ? ADD_VOTE_ACTION : DELETE_VOTE_ACTION,\n                        questionId,\n                    })\n                }\n            };\n\n            postVote();\n        }\n        // eslint-disable-next-line\n    }, [postVoteType]);\n\n    const votedState = !!questionIdMap[questionId];\n\n    let className = ''\n    if (votedState) {\n        className = 'btn rounded upvote-btn has-voted';\n    } else if (disabled) {\n        className = 'btn rounded upvote-btn';\n    } else {\n        className = 'btn btn--primary rounded upvote-btn';\n    }\n\n    return (\n        <button\n            className={className}\n            onClick={() => setPostVoteType(votedState ? DELETE_VOTE_ENUM : ADD_VOTE_ENUM)}\n            disabled={disabled}\n        >\n            <svg className=\"upvote-btn__svg\" width=\"22\" height=\"22\" viewBox=\"0 0 22 22\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M3.66797 11L4.96047 12.2925L10.0846 7.1775V18.3333H11.918V7.1775L17.033 12.3017L18.3346 11L11.0013 3.66666L3.66797 11Z\"/></svg>\n            <span className=\"upvote-btn__count\">{votes}</span>\n        </button>\n    )\n}\n\nexport default VoteButton;\n"]},"metadata":{},"sourceType":"module"}